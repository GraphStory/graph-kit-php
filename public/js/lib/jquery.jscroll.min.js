/*!
 * jScroll - jQuery Plugin for Infinite Scrolling / Auto-Paging - v2.1.1
 * http://jscroll.com/
 *
 * Copyright 2011-2013, Philip Klauzinski
 * http://klauzinski.com/
 * Dual licensed under the MIT and GPL Version 2 licenses.
 * http://jscroll.com/#license
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
 *
 * @author Philip Klauzinski
 * @requires jQuery v1.4.3+
 */
(function(e){e.jscroll={defaults:{debug:false,autoTrigger:true,loadingHtml:"<small>Loading...</small>",padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",overrideCssOverflow:false}};var t=function(t,n){function h(){var t=e(s.loadingHtml).filter("img").attr("src");if(t){var n=new Image;n.src=t}}function p(){if(!t.find(".jscroll-inner").length){t.contents().wrapAll('<div class="jscroll-inner" />')}}function d(e){if(s.pagingSelector){var t=e.closest(s.pagingSelector).hide()}else{var t=e.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide();if(!t.length){e.wrap('<div class="jscroll-next-parent" />').parent().hide()}}}function v(){return l.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()}function m(){p();if(s.overrideCssOverflow){var n=t.find("div.jscroll-inner").first(),r=t.data("jscroll"),i=parseInt(t.css("borderTopWidth")),u=isNaN(i)?0:i,a=parseInt(t.css("paddingTop"))+u,f=l.scrollTop();c=n.length?n.offset().top:0,h=Math.ceil(f-c+l.height()+a);if(g(r)&&!r.waiting&&h+s.padding>=t.outerHeight()){r.nextHref=e.trim(r.nextHref+" "+s.contentSelector);b("info","jScroll:",n.outerHeight()-h,"from bottom. Loading next request...");return y()}}else{var n=t.find("div.jscroll-inner").first(),r=t.data("jscroll"),i=parseInt(t.css("borderTopWidth")),u=isNaN(i)?0:i,a=parseInt(t.css("paddingTop"))+u,f=o?l.scrollTop():t.offset().top,c=n.length?n.offset().top:0,h=Math.ceil(f-c+l.height()+a);if(g(r)&&!r.waiting&&h+s.padding>=n.outerHeight()){r.nextHref=e.trim(r.nextHref+" "+s.contentSelector);b("info","jScroll:",n.outerHeight()-h,"from bottom. Loading next request...");return y()}}}function g(e){e=e||t.data("jscroll");if(!e.nextHref){b("warn","jScroll: nextSelector not found - destroying");t.jscroll.destroy();return false}else return true}function y(){var n=t.find("div.jscroll-inner").first(),r=t.data("jscroll");r.waiting=true;n.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading">'+s.loadingHtml+"</div>");return g(r)&&t.animate({scrollTop:n.outerHeight()},0,function(){n.find("div.jscroll-added").last().load(r.nextHref,function(n,i,o){var u=e(this).find(s.nextSelector).first();r.waiting=false;r.nextHref=s.contentSelector?u.attr("href")+" "+s.contentSelector:u.attr("href");e(".jscroll-next-parent",t).remove();if(s.autoTrigger){d(u)}else{u.bind("click.jscroll",function(){d(u);m();return false})}if(s.callback){s.callback.call(this)}b("dir",r)})})}function b(e){if(s.debug&&typeof console==="object"&&(typeof e==="object"||typeof console[e]==="function")){if(typeof e==="object"){var t=[];for(var n in e){if(typeof console[n]==="function"){t=e[n].length?e[n]:[e[n]];console[n].apply(console,t)}else{console.log.apply(console,t)}}}else{console[e].apply(console,Array.prototype.slice.call(arguments,1))}}}if(n.overrideCssOverflow){var r=t.data("jscroll"),i=typeof n==="function"?{callback:n}:n,s=e.extend({},e.jscroll.defaults,i,r||{}),o=t.css("overflow-y")==="visible",u=t.find(s.nextSelector).first(),a=e(window),f=e(document),l=e(window),c=s.contentSelector?u.attr("href")+" "+s.contentSelector:u.attr("href")}else{var r=t.data("jscroll"),i=typeof n==="function"?{callback:n}:n,s=e.extend({},e.jscroll.defaults,i,r||{}),o=t.css("overflow-y")==="visible",u=t.find(s.nextSelector).first(),a=e(window),f=e(document),l=o?e(window):t,c=s.contentSelector?u.attr("href")+" "+s.contentSelector:u.attr("href")}t.data("jscroll",e.extend({},r,{initialized:true,waiting:false,nextHref:c}));p();h();if(s.autoTrigger){d(u);l.bind("scroll.jscroll-inner",function(){return m()})}else{u.bind("click.jscroll",function(){d(u);y();return false})}e.extend(t.jscroll,{destroy:v});return t};e.fn.jscroll=function(n){return this.each(function(){var r=e(this),i=r.data("jscroll");if(i&&i.initialized)return;var s=new t(r,n)})}})(jQuery)